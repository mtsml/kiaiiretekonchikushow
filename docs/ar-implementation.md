# AR実装コンテキスト

## プロジェクト概要

このプロジェクトは、位置情報ベースのARエクスペリエンスを提供するウェブアプリケーション「あつめてハロめぐ」ですめぐ。ユーザーの現在位置を取得し、その近くにハロめぐの画像を表示しますめぐ。

### 主な機能

- 位置情報を利用したAR体験
- ユーザーの現在位置の近く（約1メートル北側）に画像を表示
- カメラを常に向く画像表示（look-at機能）

## 技術的な実装詳細

### 使用ライブラリ

- **A-Frame** (v1.3.0) - WebVRフレームワーク
- **AR.js** (v3.4.5) - ブラウザベースのAR実装
- **aframe-look-at-component** (v0.8.0) - オブジェクトがカメラを向くようにするコンポーネント

### ファイル構成

- `index.html` - メインページ（スタート画面）
- `script.js` - AR体験の開始・終了を管理するJavaScript
- `ar-experience.html` - AR体験用ページ（iframeで読み込まれる）
- `style.css` - スタイル定義

### 主要な関数

- `initAR()` - AR体験を初期化（script.js）
- `exitAR()` - AR体験を終了（script.js）
- `handleIframeMessage()` - iframeからのメッセージを処理（script.js）
- `updateGpsEntityPlace()` - 「ハロめぐをおびきよせる」ボタンの機能（未実装）

## 実装の詳細

### AR体験の開始と終了

1. ユーザーがスタート画面でハロめぐをタップすると、`initAR()`関数が呼び出される
2. `initAR()`関数は、スタート画面を非表示にし、AR体験用のiframeを作成して表示する
3. AR体験を終了するには、「バイめぐ」ボタンをタップする
4. 「バイめぐ」ボタンは親ウィンドウに'exit-ar'メッセージを送信し、`exitAR()`関数が呼び出される

### 位置情報の取得と画像の表示

1. AR体験が開始されると、AR.jsが位置情報の取得を開始する
2. 位置情報が取得されると、`gps-camera-update-position`イベントが発火する
3. イベントハンドラーは、ユーザーの現在位置の北側約1メートル（緯度+0.000009）にハロめぐの画像を表示する
4. 画像は`look-at`属性により、常にカメラ（ユーザー）の方を向く

### 画像の表示設定

- 使用画像: `hellomegkamo.png`
- スケール: x:5, y:5, z:5
- 位置: ユーザーの現在位置から北側約1メートル

## 使用方法と注意点

### 必要な許可
- カメラへのアクセス許可
- 位置情報へのアクセス許可

### 利用条件
- スマートフォンやタブレットなどのモバイルデバイスで利用
- 屋外での利用推奨（GPS精度の関係）

### 距離による表示の制限

- 非常に近い距離（数十センチ以内）では、GPS精度の問題により正確に表示できない場合がある
- 遠すぎる場合は画像が小さく見えるため、視認が難しくなる可能性がある

## 今後の開発予定

### 実装予定の機能

1. **「ハロめぐをおびきよせる」ボタンの機能実装**
   - 新しい位置にハロめぐを表示する機能

2. **デバッグ情報の表示**
   - 現在位置や距離などの情報を画面に表示

3. **複数の画像をランダムに表示**
   - 複数のハロめぐ画像からランダムに選択して表示

4. **距離に応じた表示の切り替え**
   - 距離に応じて表示内容を変更する機能
