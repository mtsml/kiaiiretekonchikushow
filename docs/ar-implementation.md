# AR実装コンテキスト

## プロジェクト概要

このプロジェクトは、位置情報ベースのARエクスペリエンスを提供するウェブアプリケーションめぐ。ユーザーが特定の場所（めぐポイント）に近づくと、距離に応じて表示が変化し、十分に近づくとARモデルが表示されますめぐ。

### 主な機能

- 位置情報を利用したAR体験
- 距離に応じた表示の切り替え
- 写真撮影機能

## 技術的な実装詳細

### 使用ライブラリ

- **A-Frame** (v1.3.0) - WebVRフレームワーク
- **AR.js** - ブラウザベースのAR実装

### 位置情報と距離計算

位置情報の取得には`navigator.geolocation`APIを使用し、以下の方法で定期的に更新していますめぐ：

1. `watchPosition`メソッドで位置情報の変更を監視
2. `setInterval`で3秒ごとに位置情報を取得

距離計算にはハーバーサイン公式を使用し、地球の曲率を考慮した正確な距離をメートル単位で計算していますめぐ：

```javascript
function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371e3; // 地球の半径（メートル）
  const φ1 = lat1 * Math.PI / 180;
  const φ2 = lat2 * Math.PI / 180;
  const Δφ = (lat2 - lat1) * Math.PI / 180;
  const Δλ = (lon2 - lon1) * Math.PI / 180;

  const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
            Math.cos(φ1) * Math.cos(φ2) *
            Math.sin(Δλ/2) * Math.sin(Δλ/2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

  return R * c; // メートル単位の距離
}
```

### 表示条件

距離に応じて表示を切り替える条件：

1. **10m以内**：ARモデルを表示
2. **10m〜100m**：「あとXXm」という距離表示
3. **100m以上**：距離表示のみ（テスト用）

### ARモデルの表示

ARモデルは以下の3種類からランダムに選択されますめぐ：

- `logo-512x512.png`（スケール：1 1 1）
- `hellomegkamo.png`（スケール：1.2 1.2 1.2）
- `haromegudayo.png`（スケール：1.5 1.5 1.5）

## 重要な座標情報

現在のめぐポイント（ターゲット位置）：
- 緯度：35.728493054835496
- 経度：139.69921490383388

## 実装の変更履歴

### 1. 初期実装
- ユーザーの現在位置を基準にARオブジェクトを配置
- 秋葉原駅周辺の特定の場所にモデルを配置

### 2. 位置の変更
- 秋葉原駅からめぐポイント（35.728493054835496, 139.69921490383388）に変更
- 複数の場所ではなく、単一の「めぐポイント」のみを対象に

### 3. 表示方法の変更
- 100m以内に近づいたら「あと何m」のように距離を表示し、モデルは非表示
- 10m以内に近づいたらモデルを表示

### 4. テスト機能の追加
- 対象との距離を常に画面に表示するテスト機能を追加
- 画面上部に半透明の黒い背景で距離を表示

## 使用方法と注意点

### 必要な許可
- カメラへのアクセス許可
- 位置情報へのアクセス許可

### 利用条件
- めぐポイントから約1km以内で利用可能
- 1km以上離れている場合はアラートが表示される

### 表示の変化
- 100m以内に近づくと「あとXXm」という距離表示が表示される
- 10m以内に近づくとモデルが表示される
- テスト用に常に距離が画面上部に表示される

## コード構成

### 主要ファイル
- `index.html` - メインページ
- `script.js` - メインのJavaScriptコード
- `ar-experience.html` - AR体験用ページ
- `style.css` - スタイル定義

### 主要な関数
- `initAR()` - AR体験を初期化
- `calculateDistance()` - 2点間の距離を計算
- `startARExperience()` - AR体験を開始
- `placeAREntities()` - ARエンティティを配置
- `updateDistances()` - 距離を更新
- `startLocationTracking()` - 位置情報の更新を監視
